knitr::opts_chunk$set(echo = TRUE)
# packages
library(xlsx)
# read the data
read.xlsx('AgencyData_clean', header=TRUE)
knitr::opts_chunk$set(echo = TRUE)
# packages
library(xlsx)
# read the data
read.xlsx('AgencyData_clean.xlsx', header=TRUE)
knitr::opts_chunk$set(echo = TRUE)
# packages
library(xlsx)
# read the data
read.xlsx('AgencyData_clean.xlsx', 1, header=TRUE)
knitr::opts_chunk$set(echo = TRUE)
# packages
library(xlsx)
# read the data
agency_data <- read.xlsx('AgencyData_clean.xlsx', 1, header=TRUE)
View(agency_data)
summary(agency_data)
knitr::opts_chunk$set(echo = TRUE)
# packages
library(xlsx)
packages.install('dataMaid')
install.packages('dataMaid')
library(dataMaid)
makeCodebook(agency_data)
View(agency_data)
View(agency_data)
source('~/GitHub/agency_data/prepare_data_scratchpad.r')
setwd("~/GitHub/agency_data")
source('~/GitHub/agency_data/prepare_data_scratchpad.r')
source('~/GitHub/agency_data/prepare_data_scratchpad.r')
source('~/GitHub/agency_data/prepare_data_scratchpad.r')
# Variable by variable analysis / preparation
# account_name
# Each instance is unique, which is expected given it's the insured name. This variable is not
# useful and should be removed.
agency_data <- agency_data_orig[!'account_name']
# Variable by variable analysis / preparation
# account_name
# Each instance is unique, which is expected given it's the insured name. This variable is not
# useful and should be removed.
agency_data <- agency_data_orig[-1]
View(agency_data)
View(agency_data_orig)
install.packages('e0171')
install.packages('e1071')
library(diplyr)
install.packages('diplyr')
install.packages('dplyr')
install.packages("dplyr")
train_ad <- sample_frac(agency_data_orig, 0.7)
sid <- as.numeric(rownames(train)) # because rownames() returns character
test_ad <- agency_data_orig[-sid,]
train_ad <- sample_frac(agency_data_orig, 0.7)
train_ad <- sample_frac(agency_data_orig, 0.7)
library(dplyr)
train_ad <- sample_frac(agency_data_orig, 0.7)
sid <- as.numeric(rownames(train)) # because rownames() returns character
sid <- as.numeric(rownames(train_ad)) # because rownames() returns character
test_ad <- agency_data_orig[-sid,]
# Trim the phat - i.e., data that's irrelevant
agency_data_used <- agency_data_orig[-1, -4]
View(agency_data_used)
agency_data_orig <- read_excel('./data/AgencyData_clean.xlsx')
# Variable by variable analysis / preparation
# account_name
# Each instance is unique, which is expected given it's the insured name. This variable is not
# useful and should be removed.
agency_data <- agency_data_orig[-1]
agency_data_orig <- read_excel('./data/AgencyData_clean.xlsx')
agency_data_orig <- read_excel('./data/AgencyData_clean.xlsx')
# Trim the phat - i.e., data that's irrelevant
agency_data_used <- agency_data_orig[-1]
View(agency_data_orig)
agency_data_orig <- read_excel('./data/AgencyData_clean.xlsx')
# Trim the phat - i.e., data that's irrelevant
agency_data_used <- agency_data_orig[-1, -4]
View(agency_data)
nb_default <- naiveBayes(transaction_type~., data=train_ad[,-4])
library(e1071)
nb_default <- naiveBayes(transaction_type~., data=train_ad[,-4])
View(nb_default)
default_pred <- predict(nb_default, test_ad, type="class")
table(default_pred, test_ad$response,dnn=c("Prediction","Actual"))
table(default_pred, test_ad$transaction_type,dnn=c("Prediction","Actual"))
default_pred <- predict(nb_default, test_ad, type="class")
nb_default <- naiveBayes(transaction_type~., data=train_ad)
default_pred <- predict(nb_default, test_ad, type="class")
View(test_ad)
# Build the model and make predictions
nb_model <- naiveBayes(transaction_type~., data=train_ad)
View(nb_model)
nb_model$tables$V2
nb_model$tables$status
View(nb_model)
nb_model$tables$account_type
nb_model$tables$assigned_agent
nb_model$tables$branch_name
View(agency_data_used)
library(readxl)
nb_model$tables$lob
nb_model$tables$master_company
nb_model$tables$effective_date
nb_model$tables$policy_term
nb_model$tables$policy_type
nb_model$tables$rating_state
nb_model$tables$status
default_pred <- predict(nb_model, test_ad, type="class")
View(test_ad)
# Setup train and test data, 70% / 30%
train_ad <- sample_frac(agency_data_used, 0.7)
sid <- as.numeric(rownames(train_ad)) # because rownames() returns character
test_ad <- agency_data_orig[-sid,]
# Build the model and make predictions
nb_model <- naiveBayes(transaction_type~., data=train_ad)
nb_model$tables$account_type
nb_model$tables$assigned_agent
nb_model$tables$lob
nb_model$tables$master_company
nb_model$tables$effective_date # bin this
nb_model$tables$policy_term
nb_model$tables$policy_type
# create one for binned premium
nb_model$tables$rating_state
nb_model$tables$status
default_pred <- predict(nb_model, test_ad, type="class")
o
# Read the original data set
agency_data_orig <- read_excel('./data/AgencyData_clean.xlsx')
# Trim the phat - i.e., data that's irrelevant
agency_data_used <- agency_data_orig[-1, -4]
# Setup train and test data, 70% / 30%
train_ad <- sample_frac(agency_data_used, 0.7)
sid <- as.numeric(rownames(train_ad)) # because rownames() returns character
test_ad <- agency_data_used[-sid,]
# Build the model and make predictions
nb_model <- naiveBayes(transaction_type~., data=train_ad)
nb_model$tables$account_type
nb_model$tables$assigned_agent
nb_model$tables$lob
nb_model$tables$master_company
nb_model$tables$effective_date # bin this
nb_model$tables$policy_term
nb_model$tables$policy_type
# create one for binned premium
nb_model$tables$rating_state
nb_model$tables$status
default_pred <- predict(nb_model, test_ad, type="class")
default_pred <- predict(nb_model, test_ad, type="raw")
View(default_pred)
default_pred <- predict(nb_model, test_ad)
typeof(train_ad$transaction_type)
str(agency_data_used)
str(agency_data_used)
# Read the original data set
agency_data_orig <- read_excel('./data/AgencyData_clean.xlsx')
# Trim the phat - i.e., data that's irrelevant
agency_data_used <- agency_data_orig[-1, -4]
View(agency_data_used)
# Read the original data set
agency_data_orig <- read_excel('./data/AgencyData_clean.xlsx')
# Trim the phat - i.e., data that's irrelevant
agency_data_used <- agency_data_orig[c(-1, -4)]
View(agency_data_used)
str(agency_data_used)
as.factor(agency_data_used$account_type)
str(agency_data_used)
agency_data_used$account_type <- as.factor(agency_data_used$account_type)
str(agency_data_used)
library(xlsx)
# Read the original data set
agency_data_orig <- read.xlsx('./data/AgencyData_clean.xlsx', stringsAsFactors=T)
# Read the original data set
agency_data_orig <- read.xlsx('./data/AgencyData_clean.xlsx', sheet=0, stringsAsFactors=T)
# Read the original data set
agency_data_orig <- read.xlsx('./data/AgencyData_clean.xlsx', 0, stringsAsFactors=T)
# Read the original data set
agency_data_orig <- read.xlsx('./data/AgencyData_clean.xlsx', 1, stringsAsFactors=T)
# Read the original data set
agency_data_orig <- read.xlsx('./data/AgencyData_clean.xlsx', sheetIndex=1, stringsAsFactors=T)
# Trim the phat - i.e., data that's irrelevant
agency_data_used <- agency_data_orig[c(-1, -4)]
str(agency_data_used)
agency_data_used$account_type <- as.factor(agency_data_used$account_type)
# Setup train and test data, 70% / 30%
train_ad <- sample_frac(agency_data_used, 0.7)
sid <- as.numeric(rownames(train_ad)) # because rownames() returns character
test_ad <- agency_data_used[-sid,]
# Build the model and make predictions
nb_model <- naiveBayes(transaction_type~., data=train_ad)
nb_model$tables$account_type
nb_model$tables$assigned_agent
nb_model$tables$lob
nb_model$tables$master_company
nb_model$tables$effective_date # bin this
nb_model$tables$policy_term
nb_model$tables$policy_type
# create one for binned premium
nb_model$tables$rating_state
nb_model$tables$status
default_pred <- predict(nb_model, test_ad)
default_pred
table(transaction_type_predict, agency_data_used$transaction_type)
transaction_type_predict <- predict(nb_model, test_ad)
table(transaction_type_predict, agency_data_used$transaction_type)
table(transaction_type_predict, test_ad$transaction_type)
table(transaction_type_predict, test_ad$account_type)
table(transaction_type_predict, test_ad$assigned_agent)
install.packages('caret')
confusion_matrix <- table(transaction_type_predict, agency_data_used$transaction_type)
nb_predict <- predict(nb_model, test_ad)
confusion_matrix <- table(nb_predict, test_ad$transaction_type)
library(caret)
plot(confusion_matrix)
confusionMatrix(confusion_matrix)
View(agency_data_used)
source('~/GitHub/agency_data/naive_bayes_model.R')
